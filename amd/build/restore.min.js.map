{"version":3,"file":"restore.min.js","sources":["../src/restore.js"],"sourcesContent":["define(['jquery', 'core/config'], function($, config) {\n\n  var session = '';\n  var session_key = '';\n  var total_records = 0;\n  var current = 0;\n  var record = 0;\n\n  var restore_users = 0;\n  var restore_blocks = 0;\n\n  var restore_courses = function() {\n\n    var course_table = $('#restore-table');\n\n    session = course_table.data('session');\n    session_key = course_table.data('key');\n\n    var record_rows = $('.record-row');\n\n    total_records = record_rows.length;\n\n    $('.progress-bar').attr('aria-valuenow', 0);\n    $('.progress-bar').attr('style', 'width: 0');\n    $('.progress-bar').html('0%');\n\n    $('.progress').removeClass('d-none');\n\n    if (total_records > 0) {\n      current = 1;\n      restore_course();\n    }\n  };\n\n  var restore_course = function() {\n\n    record = current;\n\n    var record_row = $('#record-' + record);\n\n    var categoryId = record_row.data('category');\n    var categoryPath = record_row.data('categorypath');\n    var folder = record_row.data('folder');\n    var filename = record_row.data('filename');\n    var name = record_row.data('name');\n    var shortname = record_row.data('shortname');\n    var idnumber = record_row.data('idnumber');\n    var restore_users = record_row.data('users');\n    var restore_blocks = record_row.data('blocks');\n\n    if (record > 0 && record <= total_records) {\n\n      var $url = config.wwwroot + '/admin/tool/bulk_backupandrestore/restore_course.php';\n      record_row.addClass('text-primary');\n      record_row.addClass('border-primary');\n\n      $('#record-' + record + ' > td.status').html('');\n\n      $.ajax({\n        type: \"POST\",\n        url:$url,\n        dataType: 'json',\n        data: {\n          'sesskey': session,\n          'key': session_key,\n          'category': categoryId,\n          'categorypath': categoryPath,\n          'folder': folder,\n          'filename': filename,\n          'name': name,\n          'shortname': shortname,\n          'idnumber': idnumber,\n          'restoreusers': restore_users,\n          'restoreblocks': restore_blocks,\n          'last': (record == total_records)?true:false\n        },\n        success: function(data) {\n          record_row.removeClass('border-primary');\n          record_row.removeClass('text-danger');\n          record_row.removeClass('text-primary');\n\n          var currentProgress = Math.floor((current / total_records) * 100);\n          $('.progress-bar').attr('aria-valuenow', currentProgress);\n          $('.progress-bar').attr('style', 'width: ' + currentProgress + '%');\n          $('.progress-bar').html(currentProgress + '%');\n          $('#record-' + record + ' > td.status').html(data.message);\n\n          if (data.status == true) {\n            record_row.addClass('text-success');\n          }else {\n            record_row.addClass('text-danger');\n          }\n           \n          if (record < total_records) {\n            current++;\n            restore_course();\n          }else {\n            $('.progress').hide();\n            $('.result').html(data.result);\n          }\n        },\n        error: function() {\n          window.console.log('Error on record ' + record);\n          record_row.removeClass('border-primary');\n          record_row.removeClass('text-success');\n          record_row.removeClass('text-primary');\n          record_row.addClass('text-danger');\n\n          var currentProgress = Math.floor((current / total_records) * 100);\n          $('.progress-bar').attr('aria-valuenow', currentProgress);\n          $('.progress-bar').attr('style', 'width: ' + currentProgress + '%');\n          $('.progress-bar').html(currentProgress + '%');\n\n          if (record <= total_records) {\n            current++;\n            restore_course();\n          }else {\n            $('.progress').hide();\n          }\n        }\n      });\n    }\n  };\n\n\n  return  {\n    init: function() {\n      $('#restore_courses').on('click', function() {\n        restore_courses();\n      });\n    },\n  };\n});\n"],"names":["define","$","config","session","session_key","total_records","current","record","restore_course","record_row","categoryId","data","categoryPath","folder","filename","name","shortname","idnumber","restore_users","restore_blocks","$url","wwwroot","addClass","html","ajax","type","url","dataType","success","removeClass","currentProgress","Math","floor","attr","message","status","hide","result","error","window","console","log","init","on","course_table","record_rows","length","restore_courses"],"mappings":"AAAAA,4CAAO,CAAC,SAAU,gBAAgB,SAASC,EAAGC,YAExCC,QAAU,GACVC,YAAc,GACdC,cAAgB,EAChBC,QAAU,EACVC,OAAS,EA4BTC,eAAiB,eAIfC,WAAaR,EAAE,YAFnBM,OAASD,UAILI,WAAaD,WAAWE,KAAK,YAC7BC,aAAeH,WAAWE,KAAK,gBAC/BE,OAASJ,WAAWE,KAAK,UACzBG,SAAWL,WAAWE,KAAK,YAC3BI,KAAON,WAAWE,KAAK,QACvBK,UAAYP,WAAWE,KAAK,aAC5BM,SAAWR,WAAWE,KAAK,YAC3BO,cAAgBT,WAAWE,KAAK,SAChCQ,eAAiBV,WAAWE,KAAK,aAEjCJ,OAAS,GAAKA,QAAUF,cAAe,KAErCe,KAAOlB,OAAOmB,QAAU,uDAC5BZ,WAAWa,SAAS,gBACpBb,WAAWa,SAAS,kBAEpBrB,EAAE,WAAaM,OAAS,gBAAgBgB,KAAK,IAE7CtB,EAAEuB,KAAK,CACLC,KAAM,OACNC,IAAIN,KACJO,SAAU,OACVhB,KAAM,SACOR,YACJC,qBACKM,wBACIE,oBACNC,gBACEC,cACJC,eACKC,mBACDC,sBACIC,4BACCC,oBACRZ,QAAUF,eAErBuB,QAAS,SAASjB,MAChBF,WAAWoB,YAAY,kBACvBpB,WAAWoB,YAAY,eACvBpB,WAAWoB,YAAY,oBAEnBC,gBAAkBC,KAAKC,MAAO1B,QAAUD,cAAiB,KAC7DJ,EAAE,iBAAiBgC,KAAK,gBAAiBH,iBACzC7B,EAAE,iBAAiBgC,KAAK,QAAS,UAAYH,gBAAkB,KAC/D7B,EAAE,iBAAiBsB,KAAKO,gBAAkB,KAC1C7B,EAAE,WAAaM,OAAS,gBAAgBgB,KAAKZ,KAAKuB,SAE/B,GAAfvB,KAAKwB,OACP1B,WAAWa,SAAS,gBAEpBb,WAAWa,SAAS,eAGlBf,OAASF,eACXC,UACAE,mBAEAP,EAAE,aAAamC,OACfnC,EAAE,WAAWsB,KAAKZ,KAAK0B,UAG3BC,MAAO,WACLC,OAAOC,QAAQC,IAAI,mBAAqBlC,QACxCE,WAAWoB,YAAY,kBACvBpB,WAAWoB,YAAY,gBACvBpB,WAAWoB,YAAY,gBACvBpB,WAAWa,SAAS,mBAEhBQ,gBAAkBC,KAAKC,MAAO1B,QAAUD,cAAiB,KAC7DJ,EAAE,iBAAiBgC,KAAK,gBAAiBH,iBACzC7B,EAAE,iBAAiBgC,KAAK,QAAS,UAAYH,gBAAkB,KAC/D7B,EAAE,iBAAiBsB,KAAKO,gBAAkB,KAEtCvB,QAAUF,eACZC,UACAE,kBAEAP,EAAE,aAAamC,kBAQjB,CACNM,KAAM,WACJzC,EAAE,oBAAoB0C,GAAG,SAAS,YApHhB,eAEhBC,aAAe3C,EAAE,kBAErBE,QAAUyC,aAAajC,KAAK,WAC5BP,YAAcwC,aAAajC,KAAK,WAE5BkC,YAAc5C,EAAE,eAEpBI,cAAgBwC,YAAYC,OAE5B7C,EAAE,iBAAiBgC,KAAK,gBAAiB,GACzChC,EAAE,iBAAiBgC,KAAK,QAAS,YACjChC,EAAE,iBAAiBsB,KAAK,MAExBtB,EAAE,aAAa4B,YAAY,UAEvBxB,cAAgB,IAClBC,QAAU,EACVE,kBAkGEuC"}