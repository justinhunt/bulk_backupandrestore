{"version":3,"file":"backup_category.min.js","sources":["../src/backup_category.js"],"sourcesContent":["define(['jquery', 'core/config'], function($, config) {\n\n  var session = '';\n  var session_key = '';\n  var outdir = '';\n  var total_courses = 0;\n  var current = 0;\n  var record = 0;\n\n  var backup_users = 0;\n  var backup_blocks = 0;\n\n  var backup_category = function() {\n\n    var course_table = $('#course-table');\n\n    session = course_table.data('session');\n    session_key = course_table.data('key');\n    outdir = course_table.data('outdir');\n    backup_users = course_table.data('backupusers');\n    backup_blocks = course_table.data('backupblocks');\n\n    var course_rows = $('.course-row');\n\n    total_courses = course_rows.length;\n\n    $('.progress-bar').attr('aria-valuenow', 0);\n    $('.progress-bar').attr('style', 'width: 0');\n    $('.progress-bar').html('0%');\n\n    $('.progress').removeClass('d-none');\n\n    if (total_courses > 0) {\n      current = 1;\n      backup_course();\n    }\n  };\n\n  var backup_course = function() {\n\n    record = current;\n\n    var courseId = $('.course-row-' + record).data('course');\n    var courseCategoryName = $('.course-row-' + record).data('category-name');\n    var courseCategoryPath = $('.course-row-' + record).data('category-path');\n\n    if (record > 0 && record <= total_courses) {\n\n      var $url = config.wwwroot + '/admin/tool/bulk_backupandrestore/backup_course.php';\n      $('#course-' + courseId).addClass('text-primary');\n      $('#course-' + courseId).addClass('border-primary');\n\n\n      $('#course-' + courseId + ' > td.status').html('');\n\n      $.ajax({\n        type: \"POST\",\n        url:$url,\n        dataType: 'json',\n        data: {\n          'id': courseId,\n          'sesskey': session,\n          'key': session_key,\n          'outdir' : outdir,\n          'categorypath' : courseCategoryPath,\n          'backupusers' : backup_users,\n          'backupblocks' : backup_blocks,\n          'last' : (record == total_courses)?true:false\n        },\n        success: function(data) {\n          $('#course-' + courseId).removeClass('border-primary');\n          $('#course-' + courseId).removeClass('text-primary');\n\n          var currentProgress = Math.floor((current / total_courses) * 100);\n          $('.progress-bar').attr('aria-valuenow', currentProgress);\n          $('.progress-bar').attr('style', 'width: ' + currentProgress + '%');\n          $('.progress-bar').html(currentProgress + '%');\n          $('#course-' + courseId + ' > td.status').html(data.message);\n\n          if (data.status == true) {\n            $('#course-' + courseId).addClass('text-success');\n          }else {\n            $('#course-' + courseId).addClass('text-danger');\n          }\n           \n          if (record < total_courses) {\n            current++;\n            backup_course();\n          }else {\n            $('.progress').hide();\n            $('.result').html(data.result);\n          }\n        },\n        error: function() {\n          $('#course-' + courseId).removeClass('border-primary');\n          $('#course-' + courseId).removeClass('text-primary');\n          $('#course-' + courseId).addClass('text-danger');\n\n          var currentProgress = Math.floor((current / total_courses) * 100);\n          $('.progress-bar').attr('aria-valuenow', currentProgress);\n          $('.progress-bar').attr('style', 'width: ' + currentProgress + '%');\n          $('.progress-bar').html(currentProgress + '%');\n\n          if (record <= total_courses) {\n            current++;\n            backup_course();\n          }else {\n            $('.progress').hide();\n          }\n        }\n      });\n    }\n  };\n\n\n  return  {\n    init: function() {\n      $('#backup_category').on('click', function() {\n        backup_category();\n      });\n    },\n  };\n});\n"],"names":["define","$","config","session","session_key","outdir","total_courses","current","record","backup_users","backup_blocks","backup_course","courseId","data","courseCategoryPath","$url","wwwroot","addClass","html","ajax","type","url","dataType","success","removeClass","currentProgress","Math","floor","attr","message","status","hide","result","error","init","on","course_table","course_rows","length","backup_category"],"mappings":"AAAAA,oDAAO,CAAC,SAAU,gBAAgB,SAASC,EAAGC,YAExCC,QAAU,GACVC,YAAc,GACdC,OAAS,GACTC,cAAgB,EAChBC,QAAU,EACVC,OAAS,EAETC,aAAe,EACfC,cAAgB,EA4BhBC,cAAgB,eAIdC,SAAWX,EAAE,gBAFjBO,OAASD,UAEiCM,KAAK,UAE3CC,oBADqBb,EAAE,eAAiBO,QAAQK,KAAK,iBAChCZ,EAAE,eAAiBO,QAAQK,KAAK,qBAErDL,OAAS,GAAKA,QAAUF,cAAe,KAErCS,KAAOb,OAAOc,QAAU,sDAC5Bf,EAAE,WAAaW,UAAUK,SAAS,gBAClChB,EAAE,WAAaW,UAAUK,SAAS,kBAGlChB,EAAE,WAAaW,SAAW,gBAAgBM,KAAK,IAE/CjB,EAAEkB,KAAK,CACLC,KAAM,OACNC,IAAIN,KACJO,SAAU,OACVT,KAAM,IACED,iBACKT,YACJC,mBACIC,oBACMS,+BACDL,0BACCC,mBACPF,QAAUF,eAEtBiB,QAAS,SAASV,MAChBZ,EAAE,WAAaW,UAAUY,YAAY,kBACrCvB,EAAE,WAAaW,UAAUY,YAAY,oBAEjCC,gBAAkBC,KAAKC,MAAOpB,QAAUD,cAAiB,KAC7DL,EAAE,iBAAiB2B,KAAK,gBAAiBH,iBACzCxB,EAAE,iBAAiB2B,KAAK,QAAS,UAAYH,gBAAkB,KAC/DxB,EAAE,iBAAiBiB,KAAKO,gBAAkB,KAC1CxB,EAAE,WAAaW,SAAW,gBAAgBM,KAAKL,KAAKgB,SAEjC,GAAfhB,KAAKiB,OACP7B,EAAE,WAAaW,UAAUK,SAAS,gBAElChB,EAAE,WAAaW,UAAUK,SAAS,eAGhCT,OAASF,eACXC,UACAI,kBAEAV,EAAE,aAAa8B,OACf9B,EAAE,WAAWiB,KAAKL,KAAKmB,UAG3BC,MAAO,WACLhC,EAAE,WAAaW,UAAUY,YAAY,kBACrCvB,EAAE,WAAaW,UAAUY,YAAY,gBACrCvB,EAAE,WAAaW,UAAUK,SAAS,mBAE9BQ,gBAAkBC,KAAKC,MAAOpB,QAAUD,cAAiB,KAC7DL,EAAE,iBAAiB2B,KAAK,gBAAiBH,iBACzCxB,EAAE,iBAAiB2B,KAAK,QAAS,UAAYH,gBAAkB,KAC/DxB,EAAE,iBAAiBiB,KAAKO,gBAAkB,KAEtCjB,QAAUF,eACZC,UACAI,iBAEAV,EAAE,aAAa8B,kBAQjB,CACNG,KAAM,WACJjC,EAAE,oBAAoBkC,GAAG,SAAS,YAzGhB,eAEhBC,aAAenC,EAAE,iBAErBE,QAAUiC,aAAavB,KAAK,WAC5BT,YAAcgC,aAAavB,KAAK,OAChCR,OAAS+B,aAAavB,KAAK,UAC3BJ,aAAe2B,aAAavB,KAAK,eACjCH,cAAgB0B,aAAavB,KAAK,oBAE9BwB,YAAcpC,EAAE,eAEpBK,cAAgB+B,YAAYC,OAE5BrC,EAAE,iBAAiB2B,KAAK,gBAAiB,GACzC3B,EAAE,iBAAiB2B,KAAK,QAAS,YACjC3B,EAAE,iBAAiBiB,KAAK,MAExBjB,EAAE,aAAauB,YAAY,UAEvBlB,cAAgB,IAClBC,QAAU,EACVI,iBAoFE4B"}